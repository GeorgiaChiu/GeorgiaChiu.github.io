<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    <form id='form'>
        <input type="email" name="email">
        <br>
        <label>
            <input type="checkbox" name="angry">
            Angry?
            <img id="explosion" src="https://i.imgur.com/jC14lNZ.jpg" style="width: 200px;">
        </label>
        <br>
        <input placeholder="test2" name="test2">
        <br>
        <label>
            <input type="color" name="color">
            Show me color!
        </label>
        <br>
        <input type="datetime-local" name="time">
        <br>
        <input id="submit" type="submit">
    </form>

    <h1 id="result"></h1>
</body>

<style>
    @keyframes rotating {
        from {
            transform: rotate(0deg);
        }
        to {
            transform: rotate(360deg);
        }
    }
    .rotating {
        animation: rotating 0.5s linear infinite;
    }
    #explosion {
        transition: all 1s;
        
    }
    #explosion.doomed {
        transform: scale(5);
        opacity: 0;
    }
</style>

<script>
    const apiUrl = 'https://script.google.com/macros/s/AKfycbyEXg-ukmpFZcAUJQyV84DVM_SHhNf9N9rNnm_l3apyjPCfc45J/exec';

    document.addEventListener('DOMContentLoaded', () => {
        const form = document.getElementById('form');
        form.addEventListener('submit', async e => {
            // prevent refresh page:
            e.preventDefault();

            
            // collect form data
            const formData = new FormData(form);
            // fix checkbox value to boolean
            form.querySelectorAll('input[type=checkbox]').forEach(
                input => formData.set(input.name, input.checked)
            );
            
            //可加效果
            if (!formData.get('test2') || !formData.get('email')) {
                document.getElementById('result').textContent = "資料不完整R"

                return
            } else {
                document.getElementById('result').textContent = ""
            }
            
            if (!confirm("ARE YOU SURE???")) {
                return
            }

            document.getElementById('submit').classList.add('rotating')

            // upload form (await!)
            const postReqest = await fetch(apiUrl, {
                method: 'POST',
                mode: 'cors',
                body: formData,
            })

            // decode response and log
            const response = await postReqest.json();
            console.log(postReqest, response);

            // after uploading complete effects:
            document.getElementById('submit').classList.remove('rotating')
            if (formData.get('angry') === 'true') {
                document.getElementById('explosion').classList.add('doomed')
                setTimeout(() => {
                    document.getElementById('explosion').classList.remove('doomed')
                }, 1000)
            }

            document.getElementById('result').textContent = "恭喜！";
            
            return false;
        });
    });
</script>
</html>